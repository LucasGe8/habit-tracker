{% extends 'base.html' %}

{% block content %}
<h2 style="margin-bottom: 1.5rem;">Estadísticas</h2>

<div class="habit-grid">
    {% for stat in stats %}
    <div class="card">
        <h3 style="margin-bottom: 0.5rem;">{{ stat.habit.name }}</h3>
        
        <!-- Información del hábito -->
        <div style="font-size: 0.8rem; color: #888; margin-bottom: 1rem;">
            Creado el {{ stat.habit.formatted_created_at }}
            <span style="color: #007bff; margin-left: 0.5rem;">•</span>
            <span style="color: #007bff;">{{ stat.habit.get_goal_type_display }}</span>
        </div>
        
        <!-- Métricas principales -->
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin: 1rem 0;">
            <div style="text-align: center;">
                <div style="font-size: 2rem; font-weight: bold; color: #007bff;">
                    {{ stat.current_streak }}
                </div>
                <div style="font-size: 0.8rem; color: #ccc;">Racha actual</div>
            </div>
            
            <div style="text-align: center;">
                <div style="font-size: 2rem; font-weight: bold; color: #28a745;">
                    {{ stat.tasa_exito }}%
                </div>
                <div style="font-size: 0.8rem; color: #ccc;">Tasa de éxito</div>
            </div>
        </div>
        
        <!-- Nuevas métricas híbridas -->
        <div style="background-color: #2a2a2a; border-radius: 10px; padding: 1rem; margin-top: 0.5rem;">
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; font-size: 0.9rem;">
                <div style="text-align: center;">
                    <div style="font-size: 1.5rem; font-weight: bold; color: #17a2b8;">
                        {{ stat.dias_desde_creacion }}
                    </div>
                    <div style="color: #ccc;">Días desde creación</div>
                </div>
                
                <div style="text-align: center;">
                    <div style="font-size: 1.5rem; font-weight: bold; color: #ffc107;">
                        {{ stat.total_registros }}
                    </div>
                    <div style="color: #ccc;">Días registrados</div>
                </div>
            </div>
            
            <!-- Barra de progreso del registro -->
            <div style="margin-top: 0.75rem;">
                <div style="display: flex; justify-content: space-between; font-size: 0.8rem; margin-bottom: 0.25rem;">
                    <span style="color: #ccc;">Consistencia en registro:</span>
                    <span style="color: #ffc107;">{{ stat.tasa_registro }}%</span>
                </div>
                <div style="background: #333; border-radius: 4px; height: 6px; overflow: hidden;">
                    <div style="height: 100%; background: #ffc107; width: {{ stat.tasa_registro }}%; 
                                transition: width 0.3s ease;"></div>
                </div>
            </div>
            
            <!-- Resumen de completados vs registros -->
            <div style="margin-top: 0.75rem; padding: 0.5rem; background: #333; border-radius: 5px; text-align: center;">
                <div style="font-size: 0.9rem; color: #ccc;">
                    <span style="color: #28a745;">{{ stat.completados }}</span> de 
                    <span style="color: #ffc107;">{{ stat.total_registros }}</span> días registrados completados
                </div>
                <div style="font-size: 0.8rem; color: #888; margin-top: 0.25rem;">
                    ({{ stat.dias_desde_creacion }} días totales desde creación)
                </div>
            </div>
        </div>
    </div>
    {% empty %}
    <div class="card" style="text-align: center; padding: 2rem;">
        <h3>No hay estadísticas disponibles</h3>
        <p style="margin: 1rem 0; color: #ccc;">Comienza registrando tus hábitos</p>
        <a href="{% url 'habit_create' %}" class="btn">Crear Hábito</a>
    </div>
    {% endfor %}
</div>

<style>
/* Mejoras visuales para las nuevas métricas */
.habit-grid .card {
    transition: transform 0.2s ease;
}

.habit-grid .card:hover {
    transform: translateY(-2px);
}
</style>
{% endblock %}